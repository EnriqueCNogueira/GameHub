// CONFIGURAÇÕES DE BANCO E CLIENTE

datasource db {
  provider = "sqlite"
  url      = "file:./db/gamehub.db"
}

generator client {
  provider = "prisma-client-js"
}

// TABELA DE USUARIOS

model Usuario {
  id_usuario         Int      @id @default(autoincrement())
  nome               String
  email              String   @unique
  senha              String
  saldo              Float
  data_criacao       String
  
  transacoes         Transacao[]
  itens_carrinho     Carrinho[]
  itens_biblioteca   Biblioteca[]
  itens_wishlist     Wishlist[]
  analises           Analise[]
  amizadesIniciadas  Amizades[] @relation("AmizadeIniciada")
  amizadesRecebidas  Amizades[] @relation("AmizadeRecebida")

  @@map("Usuario")
}

// TABELA DE JOGOS

model Jogo {
  id_jogo          Int      @id @default(autoincrement())
  titulo           String
  descricao        String
  preco            Float
  data_lanc        String
  id_dev           Int
  id_publi         Int
  
  desenvolvedor    Desenvolvedor @relation(fields: [id_dev], references: [id_dev])
  publicadora      Publicadora   @relation(fields: [id_publi], references: [id_publi])
  itens_transacao  ItemTransacao[]
  jogo_tag         JogoTag[]
  jogo_genero      JogoGenero[]
  analises         Analise[]
  itens_biblioteca Biblioteca[]
  itens_carrinho   Carrinho[]
  itens_wishlist   Wishlist[]

  @@map("Jogo")
}

model Desenvolvedor {
  id_dev      Int    @id @default(autoincrement())
  nome        String
  pais_origem String
  site        String
  jogos       Jogo[]

  @@map("Desenvolvedor")
}

model Publicadora {
  id_publi    Int    @id @default(autoincrement())
  nome        String
  pais_origem String
  site        String
  jogos       Jogo[]

  @@map("Publicadora")
}

model Genero {
  id_gen      Int          @id @default(autoincrement())
  nome        String
  jogo_genero JogoGenero[]

  @@map("Genero")
}

model Tag {
  id_tag   Int       @id @default(autoincrement())
  nome     String
  jogo_tag JogoTag[]

  @@map("Tag")
}

// TABELA DE TRANSACAO

model Transacao {
  id_trans    Int             @id @default(autoincrement())
  id_usuario  Int
  data_trans  String
  valor_total Float
  usuario     Usuario         @relation(fields: [id_usuario], references: [id_usuario])
  itens       ItemTransacao[]

  @@map("Transacao")
}

model ItemTransacao {
  id_jogo      Int
  id_transacao Int
  jogo         Jogo      @relation(fields: [id_jogo], references: [id_jogo])
  transacao    Transacao @relation(fields: [id_transacao], references: [id_trans])

  @@id([id_jogo, id_transacao])
  @@map("Item_Transacao")
}

model JogoTag {
  id_jogo Int
  id_tag  Int
  jogo    Jogo @relation(fields: [id_jogo], references: [id_jogo])
  tag     Tag  @relation(fields: [id_tag], references: [id_tag])

  @@id([id_jogo, id_tag])
  @@map("jogo_tag")
}

model JogoGenero {
  id_jogo Int
  id_gen  Int
  jogo    Jogo   @relation(fields: [id_jogo], references: [id_jogo])
  genero  Genero @relation(fields: [id_gen], references: [id_gen])

  @@id([id_jogo, id_gen])
  @@map("jogo_genero")
}

model Analise {
  id_jogo      Int
  id_usuario   Int
  nota         Float
  texto        String?
  data_analise String
  jogo         Jogo    @relation(fields: [id_jogo], references: [id_jogo])
  usuario      Usuario @relation(fields: [id_usuario], references: [id_usuario])

  @@id([id_jogo, id_usuario])
  @@map("analise")
}

model Biblioteca {
  id_jogo      Int
  id_usuario   Int
  tempo_jogado Float
  data_compra  String
  jogo         Jogo    @relation(fields: [id_jogo], references: [id_jogo])
  usuario      Usuario @relation(fields: [id_usuario], references: [id_usuario])

  @@id([id_jogo, id_usuario])
  @@map("biblioteca")
}

model Carrinho {
  id_jogo     Int
  id_usuario  Int
  data_adicao String
  jogo        Jogo    @relation(fields: [id_jogo], references: [id_jogo])
  usuario     Usuario @relation(fields: [id_usuario], references: [id_usuario])

  @@id([id_jogo, id_usuario])
  @@map("carrinho")
}

model Wishlist {
  id_jogo     Int
  id_usuario  Int
  data_adicao String
  jogo        Jogo    @relation(fields: [id_jogo], references: [id_jogo])
  usuario     Usuario @relation(fields: [id_usuario], references: [id_usuario])

  @@id([id_jogo, id_usuario])
  @@map("wishlist")
}

// TABELA DE AMIZADES

model Amizades {
  id_usuario   Int
  id_amigo     Int
  data_amizade String
  status       String
  iniciador    Usuario @relation("AmizadeIniciada", fields: [id_usuario], references: [id_usuario])
  amigo        Usuario @relation("AmizadeRecebida", fields: [id_amigo], references: [id_usuario])

  @@id([id_usuario, id_amigo])
  @@unique([id_amigo, id_usuario])
  @@map("amizades")
}